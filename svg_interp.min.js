var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.checkEs6ConformanceViaProxy=function(){try{var a={},b=Object.create(new $jscomp.global.Proxy(a,{get:function(c,d,e){return c==a&&"q"==d&&e==b}}));return!0===b.q}catch(c){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};
$jscomp.polyfill("WeakMap",function(a){function b(){if(!a||!Object.seal)return!1;try{var b=Object.seal({}),c=Object.seal({}),d=new a([[b,2],[c,3]]);if(2!=d.get(b)||3!=d.get(c))return!1;d.delete(b);d.set(c,4);return!d.has(b)&&4==d.get(c)}catch(k){return!1}}function c(a){$jscomp.owns(a,e)||$jscomp.defineProperty(a,e,{value:{}})}function d(a){var b=Object[a];b&&(Object[a]=function(a){c(a);return b(a)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;
var e="$jscomp_hidden_"+Math.random();d("freeze");d("preventExtensions");d("seal");var g=0,f=function(a){this.id_=(g+=Math.random()+1).toString();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};f.prototype.set=function(a,b){c(a);if(!$jscomp.owns(a,e))throw Error("WeakMap key fail: "+a);a[e][this.id_]=b;return this};f.prototype.get=function(a){return $jscomp.owns(a,e)?a[e][this.id_]:void 0};f.prototype.has=
function(a){return $jscomp.owns(a,e)&&$jscomp.owns(a[e],this.id_)};f.prototype.delete=function(a){return $jscomp.owns(a,e)&&$jscomp.owns(a[e],this.id_)?delete a[e][this.id_]:!1};return f},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(a){function b(){if($jscomp.ASSUME_NO_NATIVE_MAP||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),c=new a($jscomp.makeIterator([[b,"s"]]));if("s"!=c.get(b)||1!=c.size||c.get({x:4})||c.set({x:4},"t")!=c||2!=c.size)return!1;var d=c.entries(),e=d.next();if(e.done||e.value[0]!=b||"s"!=e.value[1])return!1;e=d.next();return e.done||4!=e.value[0].x||"t"!=e.value[1]||!d.next().done?!1:!0}catch(l){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;$jscomp.initSymbol();$jscomp.initSymbolIterator();var c=new WeakMap,d=function(a){this.data_={};this.head_=f();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};d.prototype.set=function(a,b){a=0===a?0:a;var c=e(this,a);c.list||(c.list=this.data_[c.id]=[]);c.entry?c.entry.value=b:(c.entry={next:this.head_,previous:this.head_.previous,head:this.head_,
key:a,value:b},c.list.push(c.entry),this.head_.previous.next=c.entry,this.head_.previous=c.entry,this.size++);return this};d.prototype.delete=function(a){a=e(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};d.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=f();this.size=0};d.prototype.has=function(a){return!!e(this,a).entry};
d.prototype.get=function(a){return(a=e(this,a).entry)&&a.value};d.prototype.entries=function(){return g(this,function(a){return[a.key,a.value]})};d.prototype.keys=function(){return g(this,function(a){return a.key})};d.prototype.values=function(){return g(this,function(a){return a.value})};d.prototype.forEach=function(a,b){for(var c=this.entries(),d;!(d=c.next()).done;)d=d.value,a.call(b,d[1],d[0],this)};d.prototype[Symbol.iterator]=d.prototype.entries;var e=function(a,b){var d=b&&typeof b;"object"==
d||"function"==d?c.has(b)?d=c.get(b):(d=""+ ++h,c.set(b,d)):d="p_"+b;var e=a.data_[d];if(e&&$jscomp.owns(a.data_,d))for(a=0;a<e.length;a++){var f=e[a];if(b!==b&&f.key!==f.key||b===f.key)return{id:d,list:e,index:a,entry:f}}return{id:d,list:e,index:-1,entry:void 0}},g=function(a,b){var c=a.head_;return $jscomp.iteratorPrototype(function(){if(c){for(;c.head!=a.head_;)c=c.previous;for(;c.next!=c.head;)return c=c.next,{done:!1,value:b(c)};c=null}return{done:!0,value:void 0}})},f=function(){var a={};return a.previous=
a.next=a.head=a},h=0;return d},"es6","es3");
var Interpreter={statements:void 0,global:void 0,current:void 0,frames:[],end:-1,init:function(){this.statements=void 0;this.current=this.global=new Frame(0);this.frames=[];this.end=-1},run:function(a){this.init();Lexer.init(a);Parser.init(Lexer.scanTokens());this.statements=Parser.parse();if(void 0!=this.statements&&0<this.statements.length){a=[];for(var b=$jscomp.makeIterator(this.statements),c=b.next();!c.done;c=b.next())c=c.value,c.global?(a.push(c),c instanceof TimeStep&&c.end>this.end&&(this.end=
c.end)):c.eval();this.executeTimed(a);return this.frames}},executeTimed:function(a){var b=0;do{this.current=new Frame(b);this.current.join(this.global);for(var c=$jscomp.makeIterator(a),d=c.next();!d.done;d=c.next())d.value.eval();this.frames.push(this.current.eval());++b}while(b<=this.end)},add:function(a,b,c){a=this.makeSVG(a,b,c);this.current.addTag(a)},makeSVG:function(a,b,c){a=document.createElementNS("http://www.w3.org/2000/svg",a);a.innerHTML=b;for(var d in c)a.setAttribute(d,c[d]);return a},
hasMultiple:function(){return 1<this.frames.length}},Frame=function(a){this.tags=[];this.index=a};Frame.prototype.addTag=function(a){this.tags.push(a)};Frame.prototype.join=function(a){this.tags=this.tags.concat(a.tags)};Frame.prototype.eval=function(){for(var a=document.createElementNS("http://www.w3.org/2000/svg","g"),b=0;b<this.tags.length;++b)a.appendChild(this.tags[b]);return a};Frame.prototype.constructor=Frame;
var Lexer={source:"",start:0,current:0,line:1,indent:0,errors:[],tokens:[],cssTable:document.createElement("rect").style,types:{STRING:"STRING",INTEGER:"INTEGER",BOOLEAN:"BOOLEAN",REAL:"REAL",ID:"ID",OP:"OP",KEY:"KEY",SHAPE:"SHAPE",ATTRIBUTE:"ATTRIBUTE",T:"T"},keys:{"for":"FOR","if":"IF","else":"ELSE","while":"WHILE",print:"PRINT",draw:"DRAW",rgb:"RGB",sin:"SINE",cos:"COSINE",tan:"TANGENT",log:"LOG",ln:"NAT_LOG",pi:"pi",tau:"tau"},attributes:{fill:"FILL",color:"COLOR","stroke-width":"STROKE_W",stroke:"STROKE",
"alignment-baseline":"ALIGNMENT_BASELINE","baseline-shift":"BASELINE_SHIFT",clip:"CLIP","clip-path":"CLIP_PATH","clip-rule":"CLIP_RULE","color-interpolation":"COLOR_INTER","color-interpolation-filters":"COLOR_INTER_FILTERS","color-rendering":"COLOR_RENDER",direction:"DIRECTION","dominant-baseline":"DOMINANT_BASE","fill-opacity":"FILL_OPACITY","fill-rule":"FILL_RULE",filter:"FILTER","flood-color":"FLOOD_COLOR","flood-opacity":"FLOOD_OPACITY","font-family":"FONT_FAMILY","font-size":"FONT_SIZE","font-size-adjust":"FONT_SIZE_ADJUST",
"white-space":"WHITE_SPACE","word-spacing":"WORD_SPACING","font-stretch":"FONT_STRETCHING","font-style":"FONT_STYLE","font-variant":"FONT_VARIANT","font-weight":"FONT_WEIGHT",mask:"MASK",opacity:"OPACITY",overflow:"OVERFLOW","solid-color":"SOLID_COLOR","solid-opacity":"SOLID_OPACITY","stop-color":"STOP_COLOR","stop-opacity":"STOP_OPACITY","stroke-dasharray":"STROKE_DASHARRAY","stroke-dashoffset":"STROKE_DASHOFFSET","stroke-linecap":"STROKE_LINECAP","stroke-linejoin":"STROKE_LINEJOIN","stroke-miterlimit":"STROKE_MITERLIMIT",
"stroke-opacity":"STROKE_OPACITY","text-anchor":"TEXT_ANCHOR","text-decoration":"TEXT_DECORATION","text-overflow":"TEXT_OVERFLOW","text-rendering":"TEXT_RENDER"},shapes:{rect:"RECT",circle:"CIRCLE",ellipse:"ELLIPSE",text:"TEXT",line:"LINE",polyline:"POLYLINE",polygon:"POLYGON"},init:function(a){this.tokens=[];this.source=a;this.current=this.start=0;this.line=1;this.indent=0},hasNext:function(){return this.current<this.source.length},next:function(){this.current++;return this.source.charAt(this.current-
1)},match:function(a){return this.hasNext()&&this.peek()==a?(this.current++,!0):!1},string:function(a){for(var b="";this.hasNext()&&this.peek()!=a;)"\n"==this.peek()&&this.line++,"\\"!=this.peek()||"'"!=this.peekNext()&&'"'!=this.peekNext()||this.current++,b+=this.next();if(this.hasNext())this.addToken(b,this.types.STRING);else throw new LexingError(this.line,"Unterminated String.");this.next()},isDigit:function(a){return/[0-9]/.test(a)},isText:function(a){return/[[A-Z-a-z]/.test(a)},isValidAttribute:function(a){return a in
this.cssTable},number:function(){for(;this.isDigit(this.peek());)this.next();var a=this.types.INTEGER;if("."==this.peek()&&this.isDigit(this.peekNext()))for(a=this.types.REAL,this.next();this.isDigit(this.peek());)this.next();var b=this.source.substring(this.start,this.current);this.addToken(parseFloat(b),a)},text:function(){for(;this.isText(this.peek())||"-"==this.peek().text&&this.isText(this.peekNext());)this.next();var a=this.source.substring(this.start,this.current);if(this.isValidAttribute(a))this.addToken(a,
this.types.ID);else{a=a.split("-");this.addTextToken(a[0]);for(var b=1;b<a.length;++b)this.addToken("-"),this.addTextToken(a[b])}},addTextToken:function(a){if(void 0!==this.keys[a])this.addToken(a,this.types.KEY);else if(void 0!==this.shapes[a])this.addToken(a,this.types.SHAPE);else switch(a){case "true":case "false":this.addToken(a,this.types.BOOLEAN);break;case "t":this.addToken(a,this.types.T);break;default:this.addToken(a,this.types.ID)}},comment:function(a){switch(a){case "/":if(this.match("/"))for(;"\n"!=
this.peek()&&this.hasNext();)this.next();else if(this.match("*"))for(;("/"!=this.peek()||"*"!=this.getCurrent())&&this.hasNext();)this.next();else this.addToken(a);break;case "#":for(;"\n"!=this.peek()&&this.hasNext();)this.next()}},getCurrent:function(){return this.source.charAt(this.source.length-1)},peek:function(){return this.hasNext()?this.source.charAt(this.current):"\x00"},previous:function(){return 1<this.current?this.source.charAt(this.current-2):null},previousToken:function(){if(0<this.tokens.length)return this.tokens[this.tokens.length-
1]},peekNext:function(){return this.current+1>=this.source.length?"\\0":this.source.charAt(this.current+1)},addToken:function(a,b){void 0!=b?this.tokens.push(new Token(b,a,this.line)):this.tokens.push(new Token(this.types.OP,a,this.line))},addIndent:function(){0<this.indent&&(this.tokens.push(new Indent(this.indent,this.line)),this.indent=0)},scanTokens:function(){for(;this.hasNext();)this.start=this.current,this.scanToken();if(this.hasNext())throw new LexingError(this.line,"Failed to reach EOF.");
this.addToken("\\n","NEWLINE");this.addToken("\\0","EOF");return this.tokens},scanToken:function(){var a=this.next();switch(a){case "*":case "(":case ")":case "[":case "]":case "{":case "}":case ",":case "%":case ".":case "^":case "~":case ";":this.addToken(a);break;case "+":this.match("+")?this.addToken("++"):this.match("=")?this.addToken("+="):this.addToken(a);break;case "-":this.isDigit(this.peek())&&!this.isDigit(this.previous())?this.number():this.match(">")?this.addToken("->"):this.match("-")?
this.addToken("--"):this.match("=")?this.addToken("-="):this.addToken(a);break;case "<":this.match("-")&&!/[1-9]/.test(this.peek())?this.addToken("<-"):this.match("=")?this.addToken("<="):this.addToken(a);break;case ">":this.match("=")?this.addToken(">="):this.addToken(a);break;case "=":this.match("=")?this.addToken("=="):this.addToken(a);break;case "|":this.match("=")?this.addToken("|="):this.match("|")&&this.addToken("||");break;case "!":this.match("=")?this.addToken("!="):this.addToken(a);break;
case "/":case "#":this.comment(a);break;case '"':case "'":this.string(a);break;case "\n":"\n"!=this.previous()&&void 0!=this.previousToken()&&"NEWLINE"!=this.previousToken().type&&this.addToken("\\n","NEWLINE");this.line++;for(this.indent=0;this.hasNext()&&(" "==this.peek()||"\t"==this.peek());)"\t"==this.next()&&++this.indent;0<this.indent&&"\n"!=this.peek()&&(this.tokens.push(new Indent(this.indent,this.line)),this.indent=0);break;case "\r":case "\t":case " ":break;default:this.isDigit(a)?this.number():
this.isText(a)&&this.text()}},getTokenString:function(){for(var a="",b=0;b<this.errors.length;b++)a+=this.errors[b].toString()+"\n";for(b=0;b<this.tokens.length;b++)a=a+">"+this.tokens[b].toString()+"\n";return a}},Token=function(a,b,c){this.type=a;this.text=b;this.line=c};Token.prototype.constructor=Token;Token.prototype.toString=function(){return"Type: "+this.type+"\n   -Lexeme: "+this.text+"\n   -Line #: "+this.line+"\n"};var Indent=function(a,b){Token.call(this,"INDENT","\t",b);this.num=a};
Indent.prototype=Object.create(Token.prototype);Indent.prototype.constructor=Indent;Indent.prototype.toString=function(){return"Indent\n   -Num Tabs: "+this.num+"\n   -Line #: "+this.line+"\n"};function Error(a,b){this.line=a;this.message=b}Error.prototype.constructor=Error;Error.prototype.printMessage=function(){Console.print(this.message+" (line "+this.line+")")};function ParsingError(a,b){Error.call(this,a,b)}ParsingError.prototype=Object.create(Error.prototype);
function LexingError(a,b){Error.call(this,a,b)}LexingError.prototype=Object.create(Error.prototype);function RuntimeError(a,b){Error.call(this,a,b)}RuntimeError.prototype=Object.create(Error.prototype);function Item(){this.global=!1}Item.prototype.constructor=Item;Item.prototype.setGlobal=function(a){this.global=a};function Statement(){}Statement.prototype=Object.create(Item.prototype);Statement.prototype.constructor=Statement;Statement.prototype.constructor=Statement;
function Grouping(a){this.statements=a;Statement.call(this)}Grouping.prototype=Object.create(Statement.prototype);Grouping.prototype.constructor=Grouping;function Assignment(a,b,c){Statement.call(this);this.id=a;this.operator=b;this.expr=c}Assignment.prototype=Object.create(Statement.prototype);Assignment.prototype.constructor=Assignment;
Assignment.prototype.eval=function(){switch(this.operator.text){case "=":this.id.update(this.expr,!0);break;case "|=":this.id.update(this.expr,!1);break;case "+=":this.id.update(new Literal(this.id.eval()+this.expr.eval()));break;case "-=":this.id.update(new Literal(this.id.eval()-this.expr.eval()))}};function PrintStatement(a){Statement.call(this);this.value=a}PrintStatement.prototype=Object.create(Statement.prototype);PrintStatement.prototype.constructor=PrintStatement;
PrintStatement.prototype.eval=function(){if(Array.isArray(this.value)){for(var a=this.value[0].eval()+"",b=1;b<this.value.length;++b)a+=", "+this.value[b].eval();Console.print(a)}else Console.print(this.value.eval())};function DrawStatement(a){Statement.call(this);this.shape=a}DrawStatement.prototype=Object.create(Statement.prototype);DrawStatement.prototype.constructor=DrawStatement;DrawStatement.prototype.eval=function(){this.shape.eval()};function If(a,b){Grouping.call(this,b);this.expr=a}
If.prototype=Object.create(Grouping.prototype);If.prototype.constructor=If;If.prototype.eval=function(){if(1==this.expr.eval())for(var a=0;a<this.statements.length;++a)this.statements[a].eval()};function For(a,b){Grouping.call(this,b);this.declare=a[0];this.compare=a[1];this.increment=a[2]}For.prototype=Object.create(Grouping.prototype);For.prototype.constructor=For;
For.prototype.eval=function(){for(this.declare.eval();1==this.compare.eval();){for(var a=0;a<this.statements.length;++a)this.statements[a].eval();this.increment.eval()}};function TimeStep(a,b,c,d){Grouping.call(this,c);this.global=!0;this.scope=d;a instanceof Literal&&(this.start=a.eval());this.end=b instanceof Literal?b.eval():1E3;this.statements=c;this.frames=[]}TimeStep.prototype=Object.create(Grouping.prototype);TimeStep.prototype.constructor=TimeStep;
TimeStep.prototype.eval=function(){if(this.check(Interpreter.current.index)){this.step();for(var a=0;a<this.statements.length;++a)this.statements[a].eval()}};TimeStep.prototype.step=function(){this.scope.vars.set("t",new Literal((Interpreter.current.index-this.start)/(this.end-this.start)))};TimeStep.prototype.check=function(a){return void 0==this.start?a<=this.end:void 0==this.end?a>=this.start:a>=this.start&&a<=this.end};function Shape(){Statement.call(this);this.attrs={}}Shape.prototype=Object.create(Statement.prototype);
Shape.prototype.constructor=Shape;Shape.prototype.getAttributes=function(){var a={},b;for(b in this.attrs)a[b]=this.attrs[b].eval();return a};function Rectangle(a){Shape.call(this);this.attrs.x=a[0];this.attrs.y=a[1];this.attrs.height=a[2];this.attrs.width=a[3]}Rectangle.prototype=Object.create(Shape.prototype);Rectangle.prototype.constructor=Rectangle;Rectangle.prototype.eval=function(){Interpreter.add("rect",null,this.getAttributes())};
function Circle(a){Shape.call(this);this.attrs.cx=a[0];this.attrs.cy=a[1];this.attrs.r=a[2]}Circle.prototype=Object.create(Shape.prototype);Circle.prototype.constructor=Circle;Circle.prototype.eval=function(){Interpreter.add("circle",null,this.getAttributes())};function Ellipse(a){Shape.call(this);this.attrs.cx=a[0];this.attrs.cy=a[1];this.attrs.rx=a[2];this.attrs.ry=a[3]}Ellipse.prototype=Object.create(Shape.prototype);Ellipse.prototype.constructor=Ellipse;
Ellipse.prototype.eval=function(){Interpreter.add("ellipse",null,this.getAttributes())};function Text(a){Shape.call(this);this.attrs.x=a[0];this.attrs.y=a[1];this.value=a[2]}Text.prototype=Object.create(Shape.prototype);Text.prototype.constructor=Text;Text.prototype.eval=function(){Interpreter.add("text",this.getString(),this.getAttributes())};Text.prototype.getString=function(){return void 0!=this.value?this.value.eval():null};function Polyline(a){Shape.call(this);this.coordList=a}
Polyline.prototype=Object.create(Shape.prototype);Polyline.prototype.constructor=Polyline;Polyline.prototype.eval=function(){for(var a={points:""},b=0;b<this.coordList.length;b++){var c=this.coordList[b];a.points+=c.x.eval()+","+c.y.eval()+" "}Interpreter.add("polyline",null,a)};function Polygon(a){Shape.call(this);this.coordList=a}Polygon.prototype=Object.create(Shape.prototype);Polygon.prototype.constructor=Polygon;
Polygon.prototype.eval=function(){for(var a={points:""},b=0;b<this.coordList.length;b++){var c=this.coordList[b];a.points+=c.x.eval()+","+c.y.eval()+" "}Interpreter.add("polygon",null,a)};function Line(a,b){Shape.call(this);this.attrs.x1=a.x;this.attrs.y1=a.y;this.attrs.x2=b.x;this.attrs.y2=b.y}Line.prototype=Object.create(Shape.prototype);Line.prototype.constructor=Line;Line.prototype.eval=function(){Interpreter.add("line",null,this.getAttributes())};function Expr(){}Expr.prototype=Object.create(Item.prototype);
Expr.prototype.constructor=Expr();Expr.prototype.eval=function(){};function Literal(a){Expr.call(this);this.val=a}Literal.prototype=Object.create(Expr.prototype);Literal.prototype.constructor=Literal;Literal.prototype.eval=function(){return this.val};function Variable(a,b,c){Expr.call(this);this.child=b;this.parent=a;this.scope=c}Variable.prototype=Object.create(Expr.prototype);Variable.prototype.constructor=Variable;
Variable.prototype.eval=function(){if(void 0!=this.child){var a=this.scope.getVar(this.parent);a instanceof Shape&&(a=a.attrs);if(void 0!=a[this.child.text])return a[this.child.text].eval();throw new RuntimeError(this.child.line,"Property '"+this.child.text+"' of variable '"+this.parent.text+"' is invalid.");}return this.evalParent()};Variable.prototype.evalParent=function(){return this.scope.getVar(this.parent).eval()};
Variable.prototype.update=function(a,b){a=a instanceof Shape?a:b?new Literal(a.eval()):a;void 0!=this.child?(b=this.scope.getVar(this.parent),b instanceof Shape?b.attrs[this.child.text]=a:b[this.child.text]=a,this.scope.addVar(this.parent,b)):this.scope.addVar(this.parent,a)};
function Unary(a,b,c){this.operator=a;this.right=b;this.scope=c;this.getValue=function(){var a=new Variable(this.right,null,this.scope);switch(this.operator.text){case "--":return new Literal(a.eval()-1);case "++":return new Literal(a.eval()+1);case "!":return new Literal(!a.eval())}}}Unary.prototype.constructor=Unary;function UnaryExpr(a,b,c){Expr.call(this);Unary.call(this,a,b,c)}UnaryExpr.prototype=Object.create(Expr.prototype);UnaryExpr.prototype.constructor=UnaryExpr;
UnaryExpr.prototype.eval=function(){var a=this.getValue();this.scope.addVar(this.right,a);return a.eval()};function BinaryExpr(a,b,c){Expr.call(this);this.left=a;this.operator=b;this.right=c}BinaryExpr.prototype=Object.create(Expr.prototype);BinaryExpr.prototype.constructor=BinaryExpr;
BinaryExpr.prototype.eval=function(){switch(this.operator){case "+":return this.left.eval()+this.right.eval();case "-":return this.left.eval()-this.right.eval();case "*":return this.left.eval()*this.right.eval();case "/":return this.left.eval()/this.right.eval();case "%":return this.left.eval()%this.right.eval();case "^":return Math.pow(this.left.eval(),this.right.eval())}};function Comparison(a,b,c){BinaryExpr.call(this,a,b,c)}Comparison.prototype=Object.create(BinaryExpr.prototype);
Comparison.prototype.constructor=Comparison;Comparison.prototype.eval=function(){switch(this.operator){case "==":return this.left.eval()==this.right.eval();case "!=":return this.left.eval()!=this.right.eval();case ">":return this.left.eval()>this.right.eval();case "<":return this.left.eval()<this.right.eval();case "<=":return this.left.eval()<=this.right.eval();case ">=":return this.left.eval()>=this.right.eval()}};function TrigExpr(a,b){Expr.call(this);this.operator=a;this.expr=b}
TrigExpr.prototype=Object.create(Expr.prototype);TrigExpr.prototype.constructor=TrigExpr;TrigExpr.prototype.eval=function(){switch(this.operator.text){case "sin":return Math.sin(this.expr.eval());case "cos":return Math.cos(this.expr.eval());case "tan":return Math.tan(this.expr.eval())}};function Point(a,b){Expr.call(this);this.x=a;this.y=b}Point.prototype=Object.create(Expr.prototype);Point.prototype.constructor=Point;function Color(a,b,c){Expr.call(this);this.r=a;this.g=b;this.b=c}
Color.prototype=Object.create(Expr.prototype);Color.prototype.constructor=Color;Color.prototype.eval=function(){var a="rgb("+(this.r.eval()+",");a+=this.g.eval()+",";return a+=this.b.eval()+")"};
var Parser={tokens:[],current:0,scope:void 0,init:function(a){this.current=0;this.tokens=a;this.scope=new Scope(null)},isAtEnd:function(){return"EOF"==this.peek().type},previous:function(){return 0>this.current-1||this.current-1>=this.tokens.length?null:this.tokens[this.current-1]},has:function(a){return a==this.tokens[this.current].text},peek:function(){return this.tokens[this.current]},peekNext:function(){if(!(this.current+1>=this.tokens.length))return this.tokens[this.current+1]},advance:function(){this.isAtEnd()||
this.current++;return this.previous()},consume:function(){if(0==arguments.length)return!1;for(var a=0;a<arguments.length;++a)if(this.check(arguments[a]))return this.advance();switch(arguments[arguments.length-1]){case "ID":a="Expected an identifier.";break;case "UNARY":a="Expected a unary operator.";break;default:a="Expected '"+arguments[arguments.length-1]+"'"}throw new ParsingError(this.peek().line,a);},check:function(a){return this.isAtEnd()?!1:this.peek().type==a||this.peek().text==a},match:function(){if(0==
arguments.length)return!1;for(var a=0;a<arguments.length;a++)if(this.check(arguments[a]))return this.advance(),!0;return!1},eval:function(){try{var a=this.expression()}catch(b){b.printMessage()}Console.log(a.eval())},expression:function(){return this.assignment()},grouping:function(){if(this.match("(")){var a=this.expression();this.consume(")");return a}throw new ParsingError(this.previous.line,"Expected ')'");},assignment:function(){for(var a=this.comparison();this.match("=","|=","-=","+=");){var b=
this.previous();if(a instanceof Variable){var c=this.match("SHAPE")?this.shape(this.previous()):this.expression();return new Assignment(a,b,c)}throw new ParsingError(this.previous().line,"An identifier cannot be assigned to an expression.");}return a},comparison:function(){for(var a=this.additive();this.match("!=","==","<=",">=",">","<");){var b=this.previous().text,c=this.additive();a=new Comparison(a,b,c)}return a},additive:function(){for(var a=this.multiplicative();this.match("+","-");){var b=
this.previous().text,c=this.multiplicative();a=new BinaryExpr(a,b,c)}return a},multiplicative:function(){for(var a=this.exponential();this.match("*","/","%");){var b=this.previous().text,c=this.exponential();a=new BinaryExpr(a,b,c)}return a},exponential:function(){for(var a=this.unary();this.match("^");){var b=this.previous().text,c=this.atom();a=new BinaryExpr(a,b,c)}return a},unary:function(){if(this.match("++","--")){var a=this.previous();var b=this.consume("ID");return new UnaryExpr(a,b,this.scope)}return this.atom()},
atom:function(){var a=this.advance();switch(a.type){case "ID":switch(this.peek().text){case "++":case "--":return new UnaryExpr(this.advance(),a,this.scope);case ".":this.advance();var b=this.consume("ID","ATTRIBUTE");return new Variable(a,b,this.scope);default:return new Variable(a,null,this.scope)}case "KEY":switch(a.text){case "rgb":return this.color();case "sin":case "cos":case "tan":return b=this.grouping(),new TrigExpr(a,b);case "pi":return new Literal(Math.PI);case "tau":return new Literal(2*
Math.PI)}break;case "INTEGER":return new Literal(parseInt(this.previous().text));case "REAL":return new Literal(parseFloat(this.previous().text));case "STRING":return new Literal(this.previous().text);case "BOOLEAN":return new Literal("true"==this.previous().text?!0:!1);case "OP":switch(a.text){case "(":return a=this.expression(),this.consume(")"),a;case "!":case "++":case "--":return new UnaryExpr(a,this.advance(),this.scope)}break;case "T":return new Variable(a,null,this.scope);default:throw new ParsingError(a.line,
"Missing or unrecognizeable expression.");}},shape:function(a){switch(a.text){case "rect":return this.rectStatement();case "circle":return this.circleStatement();case "ellipse":return this.ellipseStatement();case "text":return this.textStatement();case "line":return this.lineStatement();case "polygon":return this.polyStatement(a.text);case "polyline":return this.polyStatement(a.text)}},color:function(){this.consume("(");var a=this.expression();this.consume(",");var b=this.expression();this.consume(",");
var c=this.expression();this.consume(")");return new Color(a,b,c)},parse:function(){for(var a=[],b;!this.isAtEnd();)b=this.statement(),void 0!=b&&(a.push(b),b instanceof Grouping||this.match("\\n")||"EOF"==this.peek().type||this.consume(";"));return a},statement:function(){var a="INDENT"==this.peek().type?this.advance().num:0,b=this.peek();switch(b.type){case "INTEGER":var c=this.expression();return this.timestep(c,a);case "ID":c=this.expression();if(c instanceof Assignment||c instanceof UnaryExpr)return c;
throw new ParsingError(b.line,"Invalid statement.");case "T":if("L_LIMIT"!=this.peekNext().type&&"R_LIMIT"!=this.peekNext().type){c=this.expression();if(c instanceof Assignment||c instanceof UnaryExpr)return c;throw new ParsingError(b.line,"Invalid statement.");}return this.timestep(this.advance(),a);case "KEY":switch(this.advance(),b.text){case "print":return this.printStatement();case "bounds":return this.boundStatement();case "if":return this.ifStatement(a);case "for":return this.forStatement(a);
case "draw":return this.drawStatement();default:throw new ParsingError(b.line,"Keyword '"+b.text+"' must be used within an expression or statement.");}case "OP":switch(b.text){case "~":return this.advance(),a=this.statement(),a.setGlobal(!0),a;case "++":case "--":case "!":return this.expression()}break;default:this.synchronize()}},synchronize:function(){for(this.advance();!this.isAtEnd()&&("NEWLINE"!=this.previous().type||"NEWLINE"==this.peek().type);){switch(this.previous().type){case "INTEGER":case "ID":case "T":case "OP":return}this.advance()}},
globalStatement:function(){switch(this.peek().type){case "SHAPE":return new GlobalStatement(this.shape());case "ID":var a=this.expression();if(!(a instanceof Assignment))throw new ParsingError(this.peek().line,"Expected an non-unary assignment.");return a;case "ATTRIBUTE":var b=this.advance();this.consume("=");a=this.expression();return new GlobalStyle(b,a);default:throw new ParsingError(this.peek().line,"Invalid global statement.");}},block:function(a,b){var c=[],d=this.scope;this.scope=null==b?
new Scope:b;for(this.scope.superScope=d;!this.isAtEnd();)if("INDENT"==this.peek().type&&this.peek().num>a)b=this.statement(),void 0!=b?c.push(b):null,b instanceof Grouping||this.match("\\n")||"EOF"==this.peek().type||this.consume(";");else break;this.scope=this.scope.superScope;return c},methodCall:function(a){var b=[];this.consume("(");for(b.push(this.expression());this.match(a);)b.push(this.expression());this.consume(")");return b},printStatement:function(){var a=this.methodCall(",");return new PrintStatement(a)},
drawStatement:function(){if("SHAPE"==this.peek().type)var a=this.shape(this.advance());else if("ID"==this.peek().type)a=new Variable(this.advance(),null,this.scope);else throw new ParsingError(this.peek().line,"Expected a valid shape reference or declaration.");return new DrawStatement(a)},ifStatement:function(a){this.consume("(");var b=this.expression();if(!(b instanceof Comparison||b instanceof Literal))throw new ParsingError(this.peek().line,"Expected a boolean expression.");this.consume(")");
this.consume("\\n");a=this.block(a,null);return new If(b,a)},forStatement:function(a){var b=this.methodCall(";");if(!(b[0]instanceof Assignment||b[0]instanceof Variable))throw new ParsingError(this.peek().line,"Expected a declaration or assignment.");if(!(b[1]instanceof Comparison))throw new ParsingError(this.peek().line,"Expected a comparison.");if(!(b[2]instanceof UnaryExpr||b[2]instanceof Assignment))throw new ParsingError(this.peek().line,"Expected an update.");this.consume("\\n");a=this.block(a,
null);return new For(b,a)},timestep:function(a,b){var c=this.consume("<-","->");if(a instanceof Literal)switch(this.consume("T"),c.text){case "<-":var d=a;if(this.peek().text==c.text){this.advance();var e=this.expression()}else e=void 0;break;case "->":e=a,this.peek().text==c.text?(this.advance(),d=this.expression()):d=void 0}else if("T"==a.type)switch(a=this.expression(),c.text){case "<-":e=a;d=void 0;break;case "->":d=a,e=void 0}c=new Scope;this.consume("\\n");b=this.block(b,c);return new TimeStep(e,
d,b,c)},rectStatement:function(){var a=this.methodCall(",");if(4!=a.length)throw new ParsingError(this.previous().line,"Excessive or missing arguments.");return new Rectangle(a)},circleStatement:function(){var a=this.methodCall(",");if(3!=a.length)throw new ParsingError(this.previous().line,"Excessive or missing arguments.");return new Circle(a)},ellipseStatement:function(){var a=this.methodCall(",");if(4!=a.length)throw new ParsingError(this.previous().line,"Excessive or missing arguments.");return new Ellipse(a)},
textStatement:function(){var a=this.methodCall(",");if(2>a.length||3<a.length)throw new ParsingError(this.previous().line,"Excessive or missing arguments.");return new Text(a)},polyStatement:function(a){for(var b=[],c=0;2>=c;++c)b.push(this.point());for(;"INTEGER"!=this.peek().type;)b.push(this.point());switch(a){case "polyline":return new Polyline(b);case "polygon":return new Polygon(b)}},lineStatement:function(){var a=this.point(),b=this.point();return new Line(a,b)}},Scope=function(a){this.vars=
new Map;this.superScope=a};Scope.prototype.constructor=Scope;Scope.prototype.addVar=function(a,b){this.vars.set(a.text,b)};Scope.prototype.getVar=function(a){var b=this.vars.get(a.text);if(void 0!=b)return b;for(var c=this.superScope;null!=c;){b=c.vars.get(a.text);if(void 0!=b)return b;c=c.superScope}throw new RuntimeError(a.line,"'"+a.text+"' is undefined or out of scope.");};Scope.prototype.checkVar=function(a){try{this.getVar(a)}catch(b){return!1}return!0};